sudo: required

language: ruby

services:
  - docker

before_install:
  - docker build -t build-developer-rails-app .
  - docker run -it -d --publish 0.0.0.0:3000:3000 --name=build-developer-rails-app build-developer-rails-app
  - docker ps -a
  - docker run build-developer-rails-app /bin/sh -c "bundle exec rake test"

script:
  - bundle exec rake test

after_success:
  if [[ "$TRAVIS_BRANCH" == "master" ]] && [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then echo -e "Tests Passed - Push Container to Docker Hub\n-- Details: Branch($TRAVIS_BRANCH) Pull Request($TRAVIS_PULL_REQUEST) Tag($TRAVIS_TAG)"; else echo "Not uploading to Docker Hub for Branch($TRAVIS_BRANCH) Pull Request($TRAVIS_PULL_REQUEST) Tag($TRAVIS_TAG)"; fi
